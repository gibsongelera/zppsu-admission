<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ZPPSU Admission System - Login</title>
    <meta name="description" content="Zamboanga Peninsula Polytechnic State University - Online Admission Scheduling System">
    <meta name="keywords" content="ZPPSU, admission, enrollment, schedule, exam">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="uploads/zppsu1.png">
    
    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Bootstrap 4 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- AdminLTE -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.1/dist/css/adminlte.min.css">
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    
    <style>
        body {
            background-image: url("uploads/zppsu1.png");
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            min-height: 100vh;
        }
        .login-title {
            text-shadow: 2px 2px black;
            color: white;
        }
        .login-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        /* Preloader */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #343a40;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .loader-holder {
            display: flex;
            gap: 8px;
        }
        .loader-holder div {
            width: 12px;
            height: 12px;
            background: #fff;
            border-radius: 50%;
            animation: bounce 0.6s infinite alternate;
        }
        .loader-holder div:nth-child(2) { animation-delay: 0.2s; }
        .loader-holder div:nth-child(3) { animation-delay: 0.4s; }
        .loader-holder div:nth-child(4) { animation-delay: 0.6s; }
        @keyframes bounce {
            to { transform: translateY(-15px); opacity: 0.5; }
        }
        .err_msg {
            margin-bottom: 15px;
        }
    </style>
</head>
<body class="hold-transition login-page dark-mode">
    <!-- Preloader -->
    <div id="preloader">
        <div class="loader-holder">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <h1 class="text-center py-5 login-title"><b>ZPPSU Admission System</b></h1>
    
    <div class="login-box">
        <div class="card card-outline card-primary">
            <div class="card-header text-center">
                <a href="./" class="h1"><b>Login</b></a>
            </div>
            <div class="card-body">
                <p class="login-box-msg">Sign in to start your session</p>

                <form id="login-frm" action="" method="post">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" autofocus name="username" id="username" placeholder="Username">
                        <div class="input-group-append">
                            <div class="input-group-text">
                                <span class="fas fa-user"></span>
                            </div>
                        </div>
                    </div>
                    <div class="input-group mb-3">
                        <input type="password" class="form-control" name="password" id="password" placeholder="Password">
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="button" id="togglePassword" style="border-color: #ced4da;">
                                <span class="fas fa-eye"></span>
                            </button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-8"></div>
                        <div class="col-4">
                            <button type="submit" class="btn btn-primary btn-block">Sign In</button>
                        </div>
                    </div>
                </form>
                <hr>
                <div class="text-center">
                    <a class="btn btn-link" href="admin/register.php">Don't have an account? Register</a>
                    <br>
                    <a class="btn btn-link" href="admin/forgot_password.php">Forgot Password?</a>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <!-- AdminLTE App -->
    <script src="https://cdn.jsdelivr.net/npm/admin-lte@3.1/dist/js/adminlte.min.js"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // Configuration - UPDATE THIS URL to your actual server
        var _base_url_ = window.location.origin + '/zppsu_admission/';
        // For GitHub Pages deployment, change to your actual hosted server URL:
        // var _base_url_ = 'https://your-server.com/zppsu_admission/';

        // Hide preloader when page loads
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.getElementById('preloader').style.opacity = '0';
                setTimeout(function() {
                    document.getElementById('preloader').style.display = 'none';
                }, 300);
            }, 500);
        });

        $(document).ready(function(){
            // Password toggle functionality
            $('#togglePassword').on('click', function(){
                var passwordField = $('#password');
                var icon = $(this).find('span');
                
                if (passwordField.attr('type') === 'password') {
                    passwordField.attr('type', 'text');
                    icon.removeClass('fa-eye').addClass('fa-eye-slash');
                } else {
                    passwordField.attr('type', 'password');
                    icon.removeClass('fa-eye-slash').addClass('fa-eye');
                }
            });

            // Login form submission
            $('#login-frm').submit(function(e){
                e.preventDefault();
                
                // Remove previous error messages
                if($('.err_msg').length > 0)
                    $('.err_msg').remove();
                $('#login-frm').find('input').removeClass('is-invalid');

                var username = $('#username').val();
                var password = $('#password').val();

                if (!username || !password) {
                    var _msg = "<div class='alert alert-danger text-white err_msg'><i class='fa fa-exclamation-triangle'></i> Please enter both username and password</div>";
                    $('#login-frm').prepend(_msg);
                    return;
                }

                // Show loading
                Swal.fire({
                    title: 'Signing In...',
                    text: 'Please wait',
                    allowOutsideClick: false,
                    showConfirmButton: false,
                    willOpen: () => {
                        Swal.showLoading();
                    }
                });

                $.ajax({
                    url: _base_url_ + 'classes/Login.php?f=login',
                    method: 'POST',
                    data: $(this).serialize(),
                    dataType: 'json',
                    timeout: 30000,
                    error: function(xhr, status, error){
                        console.log('Login error:', status, error);
                        Swal.close();
                        var _msg = "<div class='alert alert-danger text-white err_msg'><i class='fa fa-exclamation-triangle'></i> Connection error. Please try again.</div>";
                        $('#login-frm').prepend(_msg);
                    },
                    success: function(resp){
                        Swal.close();
                        if(resp){
                            if(resp.status == 'success'){
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Welcome!',
                                    text: 'Login successful. Redirecting...',
                                    timer: 1500,
                                    showConfirmButton: false
                                }).then(function() {
                                    window.location.href = _base_url_ + 'admin/';
                                });
                            } else if(resp.status == 'incorrect'){
                                var _msg = "<div class='alert alert-danger text-white err_msg'><i class='fa fa-exclamation-triangle'></i> Incorrect username or password</div>";
                                $('#login-frm').prepend(_msg);
                                $('#login-frm').find('input').addClass('is-invalid');
                                $('#username').focus();
                            } else {
                                var _msg = "<div class='alert alert-danger text-white err_msg'><i class='fa fa-exclamation-triangle'></i> " + (resp.msg || 'Login failed. Please try again.') + "</div>";
                                $('#login-frm').prepend(_msg);
                            }
                        } else {
                            var _msg = "<div class='alert alert-danger text-white err_msg'><i class='fa fa-exclamation-triangle'></i> No response from server. Please try again.</div>";
                            $('#login-frm').prepend(_msg);
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>
